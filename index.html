<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="color-scheme" content="light dark">
    <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@latest/css/pico.lime.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <title>The Morning</title>

    <style>
      article {
        min-height: 150px;
      }

      .top-box {
        min-height: 200px;
        padding: 1.5rem; 
      }
      
      h1, h2, h3 {
        font-family: 'Pacifico', cursive;
      }

      /* Style for the new lists */
      .wiki-list {
        font-family: sans-serif;
        font-size: 0.875rem;
        padding-left: 1.25rem;
        margin: 0;
      }
      .wiki-list li {
        margin-bottom: 0.75rem;
        line-height: 1.4;
      }
      .wiki-list li::marker {
        color: var(--pico-h6-color);
      }
      .wiki-list a {
        font-weight: bold;
      }

      #potd-content figcaption {
        font-size: 0.875rem; 
        margin-top: 0.5rem; 
        font-family: sans-serif;
      }
    </style>
    </head>
  <body>

    <main class="heading">
      <center><h1>The Morning Magazine!<sup>✨</sup></h1></center><br>
    </main>

    <main class="container">
      
      <article class="top-box">
        <h2>Simple Weather</h2>
        <div class="grid" style="grid-template-columns: 3fr 1fr; gap: 1rem;">
          <label for="city">
            City Name
            <input type="text" id="city" name="city" placeholder="e.g., London" required>
          </label>
          <button id="weather-btn">Get Weather</button>
        </div>
        <div id="weather-results" style="margin-top: 1.5rem; min-height: 50px;">
          <small>Enter a city to see the weather.</small>
        </div>
      </article>

      <div class="grid">
        <article id="potd-box">
          <h3 style="font-family: 'Pacifico', cursive;">Image of the Day</h3>
          <div id="potd-content">
            <progress></progress>
          </div>
        </article>
        
        <article id="news-box">
          <h3 style="font-family: 'Pacifico', cursive;">In the News</h3>
          <div id="news-content">
            <progress></progress>
          </div>
        </article>
        
        <article id="dyk-box">
          <h3 style="font-family: 'Pacifico', cursive;">Did you know...</h3>
          <div id="dyk-content">
            <progress></progress>
          </div>
        </article>
      </div>

    </main>

    <script>
      document.getElementById('weather-btn').addEventListener('click', () => {
        const city = document.getElementById('city').value;
        const resultsDiv = document.getElementById('weather-results');
        resultsDiv.innerHTML = '<progress></progress>';

        if (!city) {
          resultsDiv.innerHTML = '<small>Please enter a city name.</small>';
          return;
        }

        fetch(`https://wttr.in/${encodeURIComponent(city)}?format=j1`)
          .then(response => {
            if (!response.ok) {
              throw new Error('City not found');
            }
            return response.json();
          })
          .then(data => {
            const weather = data.current_condition[0];
            resultsDiv.innerHTML = `
              <h3 style="margin-bottom: 0.5rem;">Weather in ${data.nearest_area[0].areaName[0].value}</h3>
              <p style="font-size: 2rem; margin-bottom: 0.5rem; font-family: sans-serif;">${weather.temp_C}°C <span style="font-size: 1rem; vertical-align: super; font-family: sans-serif;">(${weather.weatherDesc[0].value})</span></p>
              <p style="margin: 0; font-family: sans-serif;">Feels Like: ${weather.FeelsLikeC}°C | Humidity: ${weather.humidity}% | Wind: ${weather.windspeedKmph} km/h</p>
            `;
          })
          .catch(error => {
            resultsDiv.innerHTML = `<small>Sorry, could not get weather for that city. Please try again.</small>`;
            console.error(error);
          });
      });

      /**
       * Fetches the full Wikipedia featured feed (POTD, News, Did You Know).
       */
      function getWikipediaFeed() {
        const potdContent = document.getElementById('potd-content');
        const newsContent = document.getElementById('news-content');
        const dykContent = document.getElementById('dyk-content');

        if (!potdContent || !newsContent || !dykContent) return;

        const today = new Date();
        const year = today.getFullYear();
        const month = (today.getMonth() + 1).toString().padStart(2, '0');
        const day = today.getDate().toString().padStart(2, '0');
        
        const apiUrl = `https://en.wikipedia.org/api/rest_v1/feed/featured/${year}/${month}/${day}`;
        
        fetch(apiUrl)
          .then(response => {
            if (!response.ok) {
              throw new Error('Network response was not ok');
            }
            return response.json();
          })
          .then(data => {
            // 1. Populate Picture of the Day
            if (data.image && data.image.thumbnail) {
              const potd = data.image;
              const imageUrl = potd.thumbnail.source;
              const description = potd.description ? potd.description.text : 'Wikimedia Picture of the Day';
              
              potdContent.innerHTML = `
                <figure style="margin: 0;">
                  <img src="${imageUrl}" alt="Wikimedia Picture of the Day" style="width: 100%; height: auto; border-radius: 0.25rem; object-fit: cover;">
                  <figcaption>${description}</figcaption>
                </figure>
              `;
            } else {
              potdContent.innerHTML = '<small>Could not load image of the day.</small>';
            }

            // 2. Populate In the News
            if (data.news && data.news.length > 0) {
              let newsHtml = '<ul class="wiki-list">';
              data.news.forEach(item => {
                // The 'story' property often contains HTML, so we render it.
                newsHtml += `<li>${item.story}</li>`;
              });
              newsHtml += '</ul>';
              newsContent.innerHTML = newsHtml;
            } else {
              newsContent.innerHTML = '<small>No news items found for today.</small>';
            }

            // 3. Populate Did You Know
            if (data.dyk && data.dyk.length > 0) {
              let dykHtml = '<ul class="wiki-list">';
              data.dyk.forEach(item => {
                // 'text' property contains the HTML for the fact
                dykHtml += `<li>${item.text}</li>`;
              });
              dykHtml += '</ul>';
              dykContent.innerHTML = dykHtml;
            } else {
              dykContent.innerHTML = '<small>No "Did you know..." items found for today.</small>';
            }
          })
          .catch(error => {
            // Set error for all three boxes
            potdContent.innerHTML = '<small>Could not load Wikipedia feed.</small>';
            newsContent.innerHTML = '<small>Could not load Wikipedia feed.</all>';
            dykContent.innerHTML = '<small>Could not load Wikipedia feed.</small>';
            console.error('Error fetching Wikipedia feed:', error);
          });
      }

      document.addEventListener('DOMContentLoaded', getWikipediaFeed);
    </script>
    </body>
</html>